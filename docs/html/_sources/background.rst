Background
==========

We refer paper (xxx) for general introduction of the algorithm. Here, we discuss additional details on its actual implementaiton beyond the manuscript. 


Level set and volume of fluid representation of grains 
------------------------------------------------------

In the code, two representations for grains are alternatively used. The level set representation takes a sharp representation of grains, +1 inside the grain and -1 otherwise.
This is useful to identify the location of grain boundaries, which are marked as zero-surface. Prior to the convolution of characteristic functions of grains, the level set value should be converted to the volume of fluid representation which lies in [0,1]. This is done by :ref:`loc_levset_to_volfluid <CGModule_loc_levset_to_volfluid>`. The Vof representation returns to level set value when we tresholding. 



Data structures
---------------

* For efficient implementation of the threshold-dynamics algorithms, following *MATLAB* data structures are used. They are widely used as inputs and outputs of modules.   

.. _grains:

**grains** 
 *grains* is  a *MATLAB cell array* with indexed grain data containers.  
 The initial grains data structure is generated by the :ref:`grain initializers <EModule_initialdoubleVoronoidata2d>`
 It stores the following information: 
 
 grains{k,1} : List of grid points that belongs to grain k. Each point is indicated by 1d array
 
 grains{k,2} : Level set values. If the point is on the value is -1, otherwise +1 
 
 grains{k,3} : Convolution values of alpha kernel
 
 grains{k,4} : Convolution values of beta kernel
 
 .. note::
 	Each grain is defined by the list of grid indices that belong to (a) the grain itself 
 	and (b) grids that are near to outside the grain boundary. 
 	The buffering region (b) is where the results of the convolution kernel are stored.  
 	This advantageous for saving computational memeory, since we do not need to save the result
 	of kernel in the entire domain.  
 
 
.. _family:

**family** 

 Each family is a collection of grains that are located far apart. The concept of familiy
 allows to use a single kernel to all grains in the family, since their operations will not interfere each other.
 *famgrains* stores index of grains that belong to each family, while *families* follows the same structure with *grains*. 
 The family data structure generated from grains using by the :ref:`family generator <GModule_grains2families2d>`
 

.. _presence:

**presence**
 *presence* is an dim1*dim2-by-3 cell array. Each element is related to information on each grid point. 
 *it stores convolution values of near grains that are potentially considered as a choice of thresholding*.  
 Presence is inferred from *grains* using the function :ref:`get_nhd_grains function <CGModule_get_nhd_grains2d>`. 
 
 In particular, the k-th element stores the following information:
 
 presence{k,1} : Grains in the neighborhood of pixel at loc. index. 
 
 presence{k,2} : convolu vals. of those grains, in same order. 
 
 presence{k,3} : necessary information used to locate this pixel from each grains's data structure.
 


Global Variables
----------------

In the code, following global variables also are frequently used. 

.. _ori:

**ori** 

  *ori* is a 1d array that stores orientation of 2D grain respect to the reference state. 
  Its k-th element ori(k) is that of k-grain. This must be stated in radians.

.. _dims:

**dims** 

 *dims* is  a *cell array* that saves size of the domain, i.e. [nx,ny]







